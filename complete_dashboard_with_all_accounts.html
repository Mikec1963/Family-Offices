<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collins Family Office | Complete Financial Dashboard</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
            color: #2c3e50;
            line-height: 1.6;
        }

        .container {
            max-width: 1440px;
            margin: 0 auto;
            padding: 24px;
        }

        /* Header */
        header {
            background: white;
            border-radius: 8px;
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            border: 1px solid #e1e4e8;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        h1 {
            font-size: 24px;
            font-weight: 600;
            color: #1a1a1a;
            letter-spacing: -0.5px;
        }

        .header-meta {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .date-badge {
            color: #6c757d;
            font-size: 14px;
            padding: 6px 12px;
            background: #f8f9fa;
            border-radius: 4px;
        }

        .edit-config-btn {
            padding: 8px 16px;
            background: #0366d6;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .edit-config-btn:hover {
            background: #0256c7;
        }

        /* Navigation */
        .nav-container {
            display: flex;
            gap: 8px;
            border-bottom: 1px solid #e1e4e8;
            padding-bottom: 0;
            overflow-x: auto;
            white-space: nowrap;
        }

        .nav-tab {
            padding: 10px 20px;
            background: transparent;
            color: #586069;
            border: none;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            margin-bottom: -1px;
            white-space: nowrap;
        }

        .nav-tab:hover {
            color: #1a1a1a;
        }

        .nav-tab.active {
            color: #0366d6;
            border-bottom-color: #0366d6;
        }

        /* Content Areas */
        .content-area {
            display: none;
        }

        .content-area.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Data Editor Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s;
        }

        .modal.active {
            display: block;
        }

        .modal-content {
            background: white;
            margin: 20px auto;
            padding: 0;
            width: 95%;
            max-width: 1400px;
            height: calc(100vh - 40px);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid #e1e4e8;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f9fa;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: #1a1a1a;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #28a745;
            color: white;
        }

        .btn-primary:hover {
            background: #218838;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-add {
            background: #0366d6;
            color: white;
            padding: 6px 12px;
            font-size: 13px;
        }

        .btn-add:hover {
            background: #0256c7;
        }

        .btn-delete {
            background: #dc3545;
            color: white;
            padding: 4px 8px;
            font-size: 12px;
            margin-left: 8px;
        }

        .btn-delete:hover {
            background: #c82333;
        }

        .modal-body {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }

        .editor-section {
            margin-bottom: 32px;
            background: white;
            border: 1px solid #e1e4e8;
            border-radius: 8px;
            padding: 20px;
        }

        .editor-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .editor-section-title {
            font-size: 16px;
            font-weight: 600;
            color: #1a1a1a;
            padding-bottom: 8px;
            border-bottom: 2px solid #0366d6;
        }

        .editor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 16px;
        }

        .editor-field {
            display: flex;
            align-items: center;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 4px;
        }

        .editor-label {
            flex: 1;
            font-size: 13px;
            color: #2c3e50;
            margin-right: 12px;
        }

        .editor-input {
            width: 150px;
            padding: 8px 12px;
            border: 1px solid #e1e4e8;
            border-radius: 4px;
            font-size: 14px;
            font-family: 'SF Mono', monospace;
            text-align: right;
            transition: border-color 0.2s;
        }

        .editor-input:focus {
            outline: none;
            border-color: #0366d6;
            box-shadow: 0 0 0 3px rgba(3, 102, 214, 0.1);
        }

        /* Summary Cards */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .summary-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #e1e4e8;
            transition: box-shadow 0.2s;
        }

        .summary-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .summary-label {
            font-size: 12px;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .summary-value {
            font-size: 28px;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 4px;
            font-family: 'SF Mono', monospace;
        }

        .summary-detail {
            font-size: 13px;
            color: #6c757d;
        }

        .positive { color: #28a745; }
        .negative { color: #dc3545; }
        .warning { color: #ffc107; }

        /* Data Tables */
        .data-section {
            background: white;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid #e1e4e8;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e1e4e8;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #1a1a1a;
        }

        .section-subtitle {
            font-size: 13px;
            color: #6c757d;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead th {
            text-align: left;
            padding: 12px;
            font-size: 12px;
            font-weight: 600;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid #e1e4e8;
        }

        tbody td {
            padding: 12px;
            font-size: 14px;
            color: #2c3e50;
            border-bottom: 1px solid #f0f3f6;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        .text-right {
            text-align: right;
        }

        .text-center {
            text-align: center;
        }

        .mono {
            font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
        }

        /* Add new item form */
        .add-item-form {
            display: flex;
            gap: 12px;
            margin-top: 12px;
            padding: 12px;
            background: #f0f8ff;
            border-radius: 4px;
        }

        .add-item-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #e1e4e8;
            border-radius: 4px;
            font-size: 14px;
        }

        /* Success message */
        .success-message {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 12px 20px;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: none;
            animation: slideIn 0.3s;
        }

        .success-message.show {
            display: block;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-top">
                <h1>Collins Family Office</h1>
                <div class="header-meta">
                    <span class="date-badge" id="snapshot-date">As of September 9, 2025</span>
                    <button class="edit-config-btn" onclick="openEditor()">Edit Data</button>
                </div>
            </div>
            
            <nav class="nav-container">
                <button class="nav-tab active" onclick="showTab('overview')">Overview</button>
                <button class="nav-tab" onclick="showTab('assets')">Assets</button>
                <button class="nav-tab" onclick="showTab('liabilities')">Liabilities</button>
                <button class="nav-tab" onclick="showTab('cashflow')">Cash Flow</button>
                <button class="nav-tab" onclick="showTab('all-accounts')">All Accounts</button>
            </nav>
        </header>

        <!-- Overview Tab -->
        <div id="overview" class="content-area active">
            <div class="summary-grid" id="overview-summary"></div>
            <div class="chart-grid">
                <div class="data-section">
                    <div class="section-header">
                        <div>
                            <div class="section-title">Asset Allocation</div>
                        </div>
                    </div>
                    <div id="allocation-chart"></div>
                </div>
            </div>
        </div>

        <!-- Assets Tab -->
        <div id="assets" class="content-area">
            <div class="summary-grid" id="assets-summary"></div>
            <div class="data-section">
                <div class="section-header">
                    <div>
                        <div class="section-title">Asset Categories</div>
                    </div>
                </div>
                <table id="assets-table"></table>
            </div>
        </div>

        <!-- Liabilities Tab -->
        <div id="liabilities" class="content-area">
            <div class="summary-grid" id="liabilities-summary"></div>
            <div class="data-section">
                <div class="section-header">
                    <div>
                        <div class="section-title">All Liabilities</div>
                    </div>
                </div>
                <table id="liabilities-table"></table>
            </div>
        </div>

        <!-- Cash Flow Tab -->
        <div id="cashflow" class="content-area">
            <div class="summary-grid" id="cashflow-summary"></div>
            <div class="data-section">
                <div class="section-header">
                    <div>
                        <div class="section-title">Cash Flow Analysis</div>
                    </div>
                </div>
                <table id="cashflow-table"></table>
            </div>
        </div>

        <!-- All Accounts Tab -->
        <div id="all-accounts" class="content-area">
            <div class="data-section">
                <div class="section-header">
                    <div>
                        <div class="section-title">Complete Account List</div>
                        <div class="section-subtitle">Every asset and liability</div>
                    </div>
                </div>
                <table id="all-accounts-table"></table>
            </div>
        </div>
    </div>

    <!-- Data Editor Modal -->
    <div id="editorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Edit Financial Data</div>
                <div class="modal-actions">
                    <button class="btn btn-primary" onclick="saveData()">Save Changes</button>
                    <button class="btn btn-secondary" onclick="closeEditor()">Cancel</button>
                </div>
            </div>
            <div class="modal-body" id="editor-body">
                <!-- Dynamically populated -->
            </div>
        </div>
    </div>

    <!-- Success Message -->
    <div id="successMessage" class="success-message">
        Data saved successfully!
    </div>

    <script>
        // Complete financial data from spreadsheet
        let financialData = {
            cash_accounts: {
                "BOA Becky": 100000,
                "Home Cash": 10000,
                "BOA": 3000,
                "Concord Trust/IQ (various operating accounts)": 50000,
                "Schwab MD Checking": 8000,
                "Schwab DAF": 2000
            },
            jp_morgan: {
                "+Collins (0000): various Stocks, cash and near cash": 6903000,
                "+Collins (0004): Investments": 2019000,
                "+ Rebecca Collins (5008)": 760000,
                "+ Rebecca Collins CMAP (5006)": 547000,
                "+Michael Collins Madison Collateral (3004)": 521000,
                "+ Collins (1803). MC Checking": 8000,
                "+ ZRR Delta (9007)": 541000,
                "+Honeycomb Asset (4003)": 477700,
                "+ZRR Charlie Asset (5007)": 444000,
                "+2019 Trust Exempt (8003)": 411000,
                "+ZRR-Alpha Asset (5004)": 338000,
                "+ZRR Delta (6008)": 299000,
                "+ Honeycomb Bravo (9005)": 185000,
                "+2019 Trust Taxable (7000)": 180000,
                "+ Apiary (3000)": 101000,
                "+2010 Trust Exempt (2000)": 51000,
                "+Grove Street Art (4003)": 51000,
                "+2010 Trust Taxable (2002)": 36000,
                "+ZRR Real Estate (6008)": 6400,
                "+Apiary (7725)": 31000,
                "+ZRR-Alpha Checking (1721)": 29000,
                "+ZRR Charlie (8316)": 21000,
                "+ZRR (7083)": 14700,
                "+ZRR Delta (9665)": 8000,
                "+Grove Street Art (9009)": 2000,
                "+ Honeycomb (8621)": 1000,
                "+Honeycomb Bravo (8894)": 500,
                "+ MD Foundation (1008)": 32000,
                "+MD Foundation (7022)": 124000,
                "+2010 Trust Exempt Cash at Concord": 50000,
                "+2019 Trust Exempt. Cash at Concord": 50000
            },
            av_holdings: {
                "MC AV Units": 58772636,
                "RC AV Units": 19622278,
                "+2010 Trust Exempt. AV Units": 110396000,
                "+2010 Trust Taxable. AV Units": 20019064,
                "+2019 Trust Exempt. AV Units": 46802808,
                "+2019 Trust Taxable+A106": 6381284,
                "McCormack Dosh Collins Foundation AV Stock": 15028000
            },
            real_estate: {
                "Tribune Tower 1502": 4200000,
                "Manhattan Co-Op (FMV)": 2800000,
                "Bedford House (FMV)": 2600000,
                "Tribune Tower 620": 2000000,
                "Lakehouse (FMV)": 1800000,
                "42 Masbeth Unit 6B": 1600000,
                "Napa": 1425000,
                "Berkeley": 2200000,
                "Breck": 1050000,
                "1014 Rooster Run, Middleton WI": 600000,
                "2450 S 450 W St, Washington, Utah": 450000
            },
            crypto: {
                "Coinbase": 2516000,
                "Alchemix (1.1 ETH)": 4000,
                "Metamask": 1000
            },
            private_investments: {
                "Honeycomb Venture Investments at Cost": 1015000,
                "Various Private investments at cost": 2800000,
                "Grove Street Collectibles": 340000
            },
            retirement: {
                "Rebecca and Rebecca 401k": 204000,
                "Kids Retirement": 600000,
                "Fidelity (retirement)": 16000
            },
            charitable: {
                "Schwab Charitable Trust": 33300,
                "MD Foundation Cash (JP and Schwab)": 300000
            },
            other_assets: {
                "Alto": 138000,
                "Schwab": 377500,
                "[AV Bond to ZRR-Charlie #1]": 150000,
                "[AV Bond to ZRR-Charlie #2]": 250000
            },
            liabilities: {
                "Note from ZRR-A to MC for 1502": 2000000,
                "Note from ZRR to MC for Rooster Run": 400000,
                "JP/Chase LOC ($5.0M line)": 2618000,
                "JP/Chase Bedford (0564)": 948000,
                "JP/Chase Berkeley (0212)": 1206000,
                "JP/Rooster Run (4 year term note)": 400000,
                "ZRR Mortgages (Utah)": 250000,
                "Napa Mortgage": 1000000,
                "Breck Mortgage": 660000,
                "Conant Drive Mortgage": 600000,
                "JP/Chase Maspeth Mortgage": 808000,
                "Tribune Mortgage": 1390000,
                "Credit Card Average balance": 25000
            },
            distribution_rates: {
                2025: 16.8,
                2024: 20.0,
                2023: 24.5,
                2022: 23.4,
                2021: 18.0
            }
        };

        // Load saved data from localStorage
        function loadSavedData() {
            const saved = localStorage.getItem('collinsCompleteFinancialData');
            if (saved) {
                financialData = JSON.parse(saved);
            }
        }

        // Format currency to dollars with commas
        function formatDollars(value) {
            const num = parseFloat(value);
            if (isNaN(num)) return '$0';
            const isNegative = num < 0;
            const absNum = Math.abs(num);
            const formatted = '$' + absNum.toLocaleString('en-US', {
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            });
            return isNegative ? `(${formatted})` : formatted;
        }

        // Parse dollar string back to number
        function parseDollars(str) {
            if (!str) return 0;
            const cleaned = str.replace(/[$,()]/g, '').trim();
            return parseFloat(cleaned) || 0;
        }

        // Calculate metrics
        function calculateMetrics() {
            let totalAssets = 0;
            let totalLiabilities = 0;
            let totalAV = 0;
            let totalLiquid = 0;
            let totalRE = 0;
            
            // Sum all asset categories
            Object.values(financialData.cash_accounts || {}).forEach(v => totalAssets += v);
            Object.values(financialData.cash_accounts || {}).forEach(v => totalLiquid += v);
            
            Object.values(financialData.jp_morgan || {}).forEach(v => {
                totalAssets += v;
                totalLiquid += v;
            });
            
            Object.values(financialData.av_holdings || {}).forEach(v => {
                totalAssets += v;
                totalAV += v;
            });
            
            Object.values(financialData.real_estate || {}).forEach(v => {
                totalAssets += v;
                totalRE += v;
            });
            
            Object.values(financialData.crypto || {}).forEach(v => totalAssets += v);
            Object.values(financialData.private_investments || {}).forEach(v => totalAssets += v);
            Object.values(financialData.retirement || {}).forEach(v => totalAssets += v);
            Object.values(financialData.charitable || {}).forEach(v => totalAssets += v);
            Object.values(financialData.other_assets || {}).forEach(v => totalAssets += v);
            
            // Sum liabilities
            Object.values(financialData.liabilities || {}).forEach(v => totalLiabilities += Math.abs(v));
            
            const netWorth = totalAssets - totalLiabilities;
            const avConcentration = totalAssets > 0 ? (totalAV / totalAssets * 100) : 0;
            const debtToAssets = totalAssets > 0 ? (totalLiabilities / totalAssets * 100) : 0;
            const currentRate = financialData.distribution_rates[2025] || 16.8;
            const annualDistributions = totalAV * (currentRate / 100);
            const monthlyDebtService = 44572; // From spreadsheet
            const debtServiceCoverage = monthlyDebtService > 0 ? (annualDistributions / (monthlyDebtService * 12)) : 0;
            
            return {
                totalAssets,
                totalLiabilities,
                netWorth,
                totalAV,
                totalLiquid,
                totalRE,
                avConcentration,
                debtToAssets,
                annualDistributions,
                monthlyDebtService,
                debtServiceCoverage,
                currentRate
            };
        }

        // Populate overview
        function populateOverview() {
            const metrics = calculateMetrics();
            
            const html = `
                <div class="summary-card">
                    <div class="summary-label">Net Worth</div>
                    <div class="summary-value">${formatDollars(metrics.netWorth)}</div>
                    <div class="summary-detail">Total family wealth</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">Total Assets</div>
                    <div class="summary-value">${formatDollars(metrics.totalAssets)}</div>
                    <div class="summary-detail">All holdings</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">Total Liabilities</div>
                    <div class="summary-value">${formatDollars(metrics.totalLiabilities)}</div>
                    <div class="summary-detail">${metrics.debtToAssets.toFixed(1)}% of assets</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">AV Holdings</div>
                    <div class="summary-value">${formatDollars(metrics.totalAV)}</div>
                    <div class="summary-detail">${metrics.avConcentration.toFixed(1)}% concentration</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">Liquid Assets</div>
                    <div class="summary-value">${formatDollars(metrics.totalLiquid)}</div>
                    <div class="summary-detail">Cash & JP Morgan</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">Real Estate</div>
                    <div class="summary-value">${formatDollars(metrics.totalRE)}</div>
                    <div class="summary-detail">${Object.keys(financialData.real_estate).length} properties</div>
                </div>
            `;
            
            document.getElementById('overview-summary').innerHTML = html;
            
            // Create allocation chart
            const categories = [
                { name: 'Alumni Ventures', value: metrics.totalAV },
                { name: 'Real Estate', value: metrics.totalRE },
                { name: 'Liquid (Cash & JP)', value: metrics.totalLiquid },
                { name: 'Crypto', value: Object.values(financialData.crypto || {}).reduce((a,b) => a+b, 0) },
                { name: 'Private Investments', value: Object.values(financialData.private_investments || {}).reduce((a,b) => a+b, 0) },
                { name: 'Retirement', value: Object.values(financialData.retirement || {}).reduce((a,b) => a+b, 0) },
                { name: 'Other', value: Object.values(financialData.other_assets || {}).reduce((a,b) => a+b, 0) }
            ].filter(cat => cat.value > 0);
            
            const data = [{
                values: categories.map(c => c.value),
                labels: categories.map(c => c.name),
                type: 'pie',
                hole: 0.4,
                textinfo: 'label+percent',
                textposition: 'outside'
            }];
            
            const layout = {
                height: 400,
                showlegend: true,
                legend: { orientation: 'v', x: 1, y: 0.5 }
            };
            
            Plotly.newPlot('allocation-chart', data, layout, {responsive: true});
        }

        // Populate all accounts table
        function populateAllAccounts() {
            let html = `
                <thead>
                    <tr>
                        <th>Account Name</th>
                        <th>Category</th>
                        <th class="text-right">Value</th>
                    </tr>
                </thead>
                <tbody>
            `;
            
            // Add all categories
            const allCategories = [
                { name: 'Cash Accounts', data: financialData.cash_accounts },
                { name: 'JP Morgan', data: financialData.jp_morgan },
                { name: 'Alumni Ventures', data: financialData.av_holdings },
                { name: 'Real Estate', data: financialData.real_estate },
                { name: 'Crypto', data: financialData.crypto },
                { name: 'Private Investments', data: financialData.private_investments },
                { name: 'Retirement', data: financialData.retirement },
                { name: 'Charitable', data: financialData.charitable },
                { name: 'Other Assets', data: financialData.other_assets },
                { name: 'Liabilities', data: financialData.liabilities }
            ];
            
            allCategories.forEach(category => {
                if (category.data && Object.keys(category.data).length > 0) {
                    // Category header
                    html += `
                        <tr style="background: #f8f9fa; font-weight: 600;">
                            <td colspan="2">${category.name}</td>
                            <td class="text-right">${formatDollars(Object.values(category.data).reduce((a,b) => a+b, 0))}</td>
                        </tr>
                    `;
                    
                    // Individual items
                    Object.entries(category.data).forEach(([name, value]) => {
                        html += `
                            <tr>
                                <td style="padding-left: 24px;">${name}</td>
                                <td>${category.name}</td>
                                <td class="text-right mono">${formatDollars(value)}</td>
                            </tr>
                        `;
                    });
                }
            });
            
            html += '</tbody>';
            document.getElementById('all-accounts-table').innerHTML = html;
        }

        // Populate editor modal
        function populateEditor() {
            let html = '';
            
            const categories = [
                { key: 'cash_accounts', title: 'Cash Accounts' },
                { key: 'jp_morgan', title: 'JP Morgan Accounts' },
                { key: 'av_holdings', title: 'Alumni Ventures Holdings' },
                { key: 'real_estate', title: 'Real Estate' },
                { key: 'crypto', title: 'Cryptocurrency' },
                { key: 'private_investments', title: 'Private Investments' },
                { key: 'retirement', title: 'Retirement Accounts' },
                { key: 'charitable', title: 'Charitable Assets' },
                { key: 'other_assets', title: 'Other Assets' },
                { key: 'liabilities', title: 'Liabilities' }
            ];
            
            categories.forEach(category => {
                html += `
                    <div class="editor-section">
                        <div class="editor-section-header">
                            <div class="editor-section-title">${category.title}</div>
                            <button class="btn btn-add" onclick="showAddForm('${category.key}')">+ Add Item</button>
                        </div>
                        <div id="add-form-${category.key}" style="display: none;" class="add-item-form">
                            <input type="text" class="add-item-input" id="add-name-${category.key}" placeholder="Account name">
                            <input type="text" class="add-item-input" id="add-value-${category.key}" placeholder="Value ($)" style="width: 150px;">
                            <button class="btn btn-primary" onclick="addItem('${category.key}')">Add</button>
                            <button class="btn btn-secondary" onclick="hideAddForm('${category.key}')">Cancel</button>
                        </div>
                        <div class="editor-grid" id="editor-${category.key}">
                `;
                
                if (financialData[category.key]) {
                    Object.entries(financialData[category.key]).forEach(([name, value]) => {
                        const fieldId = `${category.key}-${name.replace(/[^a-zA-Z0-9]/g, '_')}`;
                        html += `
                            <div class="editor-field">
                                <div class="editor-label">${name}</div>
                                <input type="text" class="editor-input" id="${fieldId}" value="${formatDollars(value)}" 
                                    onchange="updateValue('${category.key}', '${name}', this.value)">
                                <button class="btn btn-delete" onclick="deleteItem('${category.key}', '${name}')">Ã—</button>
                            </div>
                        `;
                    });
                }
                
                html += `
                        </div>
                    </div>
                `;
            });
            
            // Add distribution rates section
            html += `
                <div class="editor-section">
                    <div class="editor-section-title">Distribution Rates (%)</div>
                    <div class="editor-grid">
            `;
            
            Object.entries(financialData.distribution_rates || {}).forEach(([year, rate]) => {
                html += `
                    <div class="editor-field">
                        <div class="editor-label">${year} Rate</div>
                        <input type="text" class="editor-input" id="rate-${year}" value="${rate}%" 
                            onchange="updateRate('${year}', this.value)">
                    </div>
                `;
            });
            
            html += `
                    </div>
                </div>
            `;
            
            document.getElementById('editor-body').innerHTML = html;
        }

        // Update value in data structure
        function updateValue(category, name, value) {
            const numValue = parseDollars(value);
            if (financialData[category]) {
                financialData[category][name] = numValue;
            }
        }

        // Update distribution rate
        function updateRate(year, value) {
            const numValue = parseFloat(value.replace('%', ''));
            if (!isNaN(numValue)) {
                financialData.distribution_rates[year] = numValue;
            }
        }

        // Show add form
        function showAddForm(category) {
            document.getElementById(`add-form-${category}`).style.display = 'flex';
        }

        // Hide add form
        function hideAddForm(category) {
            document.getElementById(`add-form-${category}`).style.display = 'none';
            document.getElementById(`add-name-${category}`).value = '';
            document.getElementById(`add-value-${category}`).value = '';
        }

        // Add new item
        function addItem(category) {
            const name = document.getElementById(`add-name-${category}`).value.trim();
            const value = parseDollars(document.getElementById(`add-value-${category}`).value);
            
            if (name && !isNaN(value)) {
                if (!financialData[category]) {
                    financialData[category] = {};
                }
                financialData[category][name] = value;
                populateEditor();
                hideAddForm(category);
            }
        }

        // Delete item
        function deleteItem(category, name) {
            if (confirm(`Delete "${name}"?`)) {
                if (financialData[category]) {
                    delete financialData[category][name];
                    populateEditor();
                }
            }
        }

        // Editor functions
        function openEditor() {
            populateEditor();
            document.getElementById('editorModal').classList.add('active');
        }

        function closeEditor() {
            document.getElementById('editorModal').classList.remove('active');
        }

        function saveData() {
            // Save to localStorage
            localStorage.setItem('collinsCompleteFinancialData', JSON.stringify(financialData));
            
            // Close modal and refresh
            closeEditor();
            refreshAllTabs();
            
            // Show success message
            const msg = document.getElementById('successMessage');
            msg.classList.add('show');
            setTimeout(() => msg.classList.remove('show'), 3000);
        }

        // Populate other tabs
        function populateAssets() {
            const metrics = calculateMetrics();
            
            const summaryHtml = `
                <div class="summary-card">
                    <div class="summary-label">Total Assets</div>
                    <div class="summary-value">${formatDollars(metrics.totalAssets)}</div>
                    <div class="summary-detail">All holdings</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">Alumni Ventures</div>
                    <div class="summary-value">${formatDollars(metrics.totalAV)}</div>
                    <div class="summary-detail">${Object.keys(financialData.av_holdings).length} positions</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">Liquid Assets</div>
                    <div class="summary-value">${formatDollars(metrics.totalLiquid)}</div>
                    <div class="summary-detail">Immediate access</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">Real Estate</div>
                    <div class="summary-value">${formatDollars(metrics.totalRE)}</div>
                    <div class="summary-detail">${Object.keys(financialData.real_estate).length} properties</div>
                </div>
            `;
            
            document.getElementById('assets-summary').innerHTML = summaryHtml;
            
            // Create category summary table
            let tableHtml = `
                <thead>
                    <tr>
                        <th>Category</th>
                        <th class="text-center">Items</th>
                        <th class="text-right">Total Value</th>
                        <th class="text-right">% of Assets</th>
                    </tr>
                </thead>
                <tbody>
            `;
            
            const categories = [
                { name: 'Alumni Ventures', data: financialData.av_holdings },
                { name: 'JP Morgan Accounts', data: financialData.jp_morgan },
                { name: 'Real Estate', data: financialData.real_estate },
                { name: 'Private Investments', data: financialData.private_investments },
                { name: 'Cryptocurrency', data: financialData.crypto },
                { name: 'Retirement', data: financialData.retirement },
                { name: 'Cash Accounts', data: financialData.cash_accounts },
                { name: 'Charitable', data: financialData.charitable },
                { name: 'Other Assets', data: financialData.other_assets }
            ];
            
            categories.forEach(cat => {
                if (cat.data) {
                    const total = Object.values(cat.data).reduce((a,b) => a+b, 0);
                    const pct = metrics.totalAssets > 0 ? (total / metrics.totalAssets * 100) : 0;
                    tableHtml += `
                        <tr>
                            <td>${cat.name}</td>
                            <td class="text-center">${Object.keys(cat.data).length}</td>
                            <td class="text-right mono">${formatDollars(total)}</td>
                            <td class="text-right">${pct.toFixed(1)}%</td>
                        </tr>
                    `;
                }
            });
            
            tableHtml += '</tbody>';
            document.getElementById('assets-table').innerHTML = tableHtml;
        }

        function populateLiabilities() {
            const totalLiabilities = Object.values(financialData.liabilities || {}).reduce((a,b) => a + Math.abs(b), 0);
            const metrics = calculateMetrics();
            
            const summaryHtml = `
                <div class="summary-card">
                    <div class="summary-label">Total Debt</div>
                    <div class="summary-value">${formatDollars(totalLiabilities)}</div>
                    <div class="summary-detail">${Object.keys(financialData.liabilities).length} obligations</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">Monthly Service</div>
                    <div class="summary-value">${formatDollars(metrics.monthlyDebtService)}</div>
                    <div class="summary-detail">Est. payment</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">Debt-to-Assets</div>
                    <div class="summary-value">${metrics.debtToAssets.toFixed(1)}%</div>
                    <div class="summary-detail">${metrics.debtToAssets < 30 ? 'Conservative' : 'Moderate'}</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">Coverage Ratio</div>
                    <div class="summary-value">${metrics.debtServiceCoverage.toFixed(1)}x</div>
                    <div class="summary-detail">${metrics.debtServiceCoverage > 1.5 ? 'Excellent' : 'Good'}</div>
                </div>
            `;
            
            document.getElementById('liabilities-summary').innerHTML = summaryHtml;
            
            // Liabilities table
            let tableHtml = `
                <thead>
                    <tr>
                        <th>Obligation</th>
                        <th>Type</th>
                        <th class="text-right">Amount</th>
                        <th class="text-right">% of Total</th>
                    </tr>
                </thead>
                <tbody>
            `;
            
            Object.entries(financialData.liabilities || {}).forEach(([name, value]) => {
                const amount = Math.abs(value);
                const pct = totalLiabilities > 0 ? (amount / totalLiabilities * 100) : 0;
                const type = name.toLowerCase().includes('mortgage') ? 'Mortgage' : 
                            name.toLowerCase().includes('loc') || name.toLowerCase().includes('line') ? 'Line of Credit' :
                            name.toLowerCase().includes('note') ? 'Note' : 'Other';
                
                tableHtml += `
                    <tr>
                        <td>${name}</td>
                        <td>${type}</td>
                        <td class="text-right mono">${formatDollars(amount)}</td>
                        <td class="text-right">${pct.toFixed(1)}%</td>
                    </tr>
                `;
            });
            
            tableHtml += `
                <tr style="border-top: 2px solid #e1e4e8; font-weight: 600;">
                    <td colspan="2">Total Liabilities</td>
                    <td class="text-right mono">${formatDollars(totalLiabilities)}</td>
                    <td class="text-right">100.0%</td>
                </tr>
            </tbody>`;
            
            document.getElementById('liabilities-table').innerHTML = tableHtml;
        }

        function populateCashFlow() {
            const metrics = calculateMetrics();
            const monthlyDist = metrics.annualDistributions / 12;
            const netCashFlow = monthlyDist - metrics.monthlyDebtService;
            
            const summaryHtml = `
                <div class="summary-card">
                    <div class="summary-label">Annual Distributions</div>
                    <div class="summary-value">${formatDollars(metrics.annualDistributions)}</div>
                    <div class="summary-detail">From AV @ ${metrics.currentRate}%</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">Monthly Income</div>
                    <div class="summary-value">${formatDollars(monthlyDist)}</div>
                    <div class="summary-detail">Average</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">Monthly Debt Service</div>
                    <div class="summary-value">${formatDollars(metrics.monthlyDebtService)}</div>
                    <div class="summary-detail">Obligations</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">Net Cash Flow</div>
                    <div class="summary-value ${netCashFlow > 0 ? 'positive' : 'negative'}">${formatDollars(netCashFlow)}</div>
                    <div class="summary-detail">Monthly surplus</div>
                </div>
            `;
            
            document.getElementById('cashflow-summary').innerHTML = summaryHtml;
            
            // Cash flow table
            const tableHtml = `
                <thead>
                    <tr>
                        <th>Category</th>
                        <th class="text-right">Monthly</th>
                        <th class="text-right">Annual</th>
                    </tr>
                </thead>
                <tbody>
                    <tr style="font-weight: 600;">
                        <td>INCOME</td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td style="padding-left: 24px;">AV Distributions (${metrics.currentRate}%)</td>
                        <td class="text-right mono">${formatDollars(monthlyDist)}</td>
                        <td class="text-right mono">${formatDollars(metrics.annualDistributions)}</td>
                    </tr>
                    <tr style="font-weight: 600;">
                        <td>EXPENSES</td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td style="padding-left: 24px;">Debt Service</td>
                        <td class="text-right mono">${formatDollars(metrics.monthlyDebtService)}</td>
                        <td class="text-right mono">${formatDollars(metrics.monthlyDebtService * 12)}</td>
                    </tr>
                    <tr>
                        <td style="padding-left: 24px;">Est. Living Expenses</td>
                        <td class="text-right mono">${formatDollars(166667)}</td>
                        <td class="text-right mono">${formatDollars(2000000)}</td>
                    </tr>
                    <tr style="border-top: 2px solid #e1e4e8; font-weight: 600;">
                        <td>NET CASH FLOW</td>
                        <td class="text-right mono ${netCashFlow - 166667 > 0 ? 'positive' : 'negative'}">
                            ${formatDollars(netCashFlow - 166667)}
                        </td>
                        <td class="text-right mono ${(netCashFlow - 166667) * 12 > 0 ? 'positive' : 'negative'}">
                            ${formatDollars((netCashFlow - 166667) * 12)}
                        </td>
                    </tr>
                </tbody>
            `;
            
            document.getElementById('cashflow-table').innerHTML = tableHtml;
        }

        // Tab switching
        function showTab(tabName) {
            // Hide all content areas
            document.querySelectorAll('.content-area').forEach(area => {
                area.classList.remove('active');
            });
            
            // Remove active from all tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected content
            document.getElementById(tabName).classList.add('active');
            
            // Mark tab as active
            event.target.classList.add('active');
            
            // Populate content
            switch(tabName) {
                case 'overview':
                    populateOverview();
                    break;
                case 'assets':
                    populateAssets();
                    break;
                case 'liabilities':
                    populateLiabilities();
                    break;
                case 'cashflow':
                    populateCashFlow();
                    break;
                case 'all-accounts':
                    populateAllAccounts();
                    break;
            }
        }

        // Refresh all tabs
        function refreshAllTabs() {
            const activeTab = document.querySelector('.content-area.active').id;
            showTab(activeTab);
        }

        // Initialize
        window.onload = function() {
            loadSavedData();
            populateOverview();
        };

        // Close modal on escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeEditor();
            }
        });

        // Close modal on outside click
        document.getElementById('editorModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeEditor();
            }
        });
    </script>
</body>
</html>
